<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Inscription ‚Äî Dict√©e de Rentr√©e (09/09)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Palette & petite config Tailwind (facultative)
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            ink: '#222222',
            stroke: '#3b3b3b',
            pastel: {
              bg: '#FFF9E9',
              accent: '#FFD166',
              mint: '#B8F2E6',
              blue: '#A8D8FF',
              pink: '#F8CFE6',
              green: '#BDE4A8'
            }
          },
          boxShadow: {
            sk: '0 8px 24px rgba(0,0,0,.08)'
          },
          animation: {
            pop: 'pop .25s ease-out',
            float: 'float 6s ease-in-out infinite',
            pulseSlow: 'pulse 3s infinite'
          },
          keyframes: {
            pop: { '0%': { transform: 'scale(.95)', opacity: 0 }, '100%': { transform: 'scale(1)', opacity: 1 } },
            float: { '0%': { transform: 'translateY(0px)' }, '50%': { transform: 'translateY(-6px)' }, '100%': { transform: 'translateY(0px)' } }
          }
        }
      }
    }
  </script>
  <style>
    /* Fond √† petits points + bordures "croquis" */
    body { background:
      radial-gradient(circle at 1px 1px, rgba(0,0,0,.06) 1px, transparent 1px) 0 0/12px 12px,
      #FFF9E9;
    }
    .sketch {
      border: 2px dashed #3b3b3b;
      border-radius: 18px;
    }
    .btn-oval {
      border-radius: 9999px;
      border: 2px dashed #3b3b3b;
    }
    .scribble {
      background:
        linear-gradient(120deg, rgba(255,209,102,.3), rgba(255,209,102,0)) no-repeat;
      background-size: 100% 55%;
      background-position: 0 70%;
    }
  </style>
</head>
<body class="text-ink selection:bg-pastel-blue/50">
  <!-- Header -->
  <header class="max-w-5xl mx-auto px-4 pt-8 pb-6">
    <div class="sketch bg-white/80 shadow-sk p-5 flex items-center gap-4 animate-pop">
      <!-- Ic√¥ne casquette/√©cole (SVG) -->
      <svg class="w-10 h-10 shrink-0 animate-float" viewBox="0 0 24 24" fill="none" stroke="#222" stroke-width="1.5">
        <path d="M12 3L1.5 8.25 12 13.5 22.5 8.25 12 3Z" fill="#B8F2E6" />
        <path d="M4 10v4.5c0 .6.4 1.1 1 1.3l7 2.4 7-2.4c.6-.2 1-.7 1-1.3V10" fill="#F8CFE6"/>
        <path d="M12 13.5v6" />
      </svg>
      <div class="flex-1">
        <h1 class="text-2xl md:text-3xl font-bold tracking-tight">
          <span class="scribble">Inscription ‚Äî Dict√©e de Rentr√©e</span>
        </h1>
        <p class="mt-1 text-sm md:text-base text-stone-700">
          üìÖ <b>Mardi 9 septembre 2025</b> ‚Ä¢ ‚è±Ô∏è 15 minutes ‚Ä¢ üë• √âv√©nement QVCT
        </p>
      </div>
      <span class="hidden md:inline-flex items-center gap-2 text-sm btn-oval px-4 py-2 bg-pastel-mint/60">
        <span>üéí ‚ÄúPause Cartable‚Äù</span>
      </span>
    </div>

    <!-- Bandeau info prod -->
    <div class="mt-4 sketch bg-pastel-blue/40 p-4 text-sm leading-relaxed">
      <p class="font-medium">‚ÑπÔ∏è L‚Äôatelier se d√©roule <b>sur le temps de production</b>.</p>
      <p>Pense √† pr√©venir ton encadrant et √† choisir un cr√©neau compatible avec l‚Äôactivit√© du service.</p>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-5xl mx-auto px-4 pb-16 grid lg:grid-cols-5 gap-6 items-start">
    <!-- Form -->
    <section class="lg:col-span-3 sketch bg-white/90 shadow-sk p-6">
      <h2 class="text-xl font-semibold flex items-center gap-2 mb-4">
        <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="#222" stroke-width="1.5">
          <path d="M4 5h16M4 12h16M4 19h16" />
        </svg>
        Formulaire d‚Äôinscription
      </h2>

      <form id="inscriptionForm" class="space-y-5">
        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium mb-1">Pr√©nom <span class="text-red-600">*</span></label>
            <input name="prenom" required class="w-full sketch bg-white px-3 py-2 outline-none focus:ring-2 focus:ring-pastel-accent" placeholder="Ex. L√©a" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Nom <span class="text-red-600">*</span></label>
            <input name="nom" required class="w-full sketch bg-white px-3 py-2 outline-none focus:ring-2 focus:ring-pastel-accent" placeholder="Ex. Martin" />
          </div>
        </div>

        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium mb-1">Email pro <span class="text-red-600">*</span></label>
            <input name="email" type="email" required class="w-full sketch bg-white px-3 py-2 outline-none" placeholder="prenom.nom@entreprise.fr" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Service / Plateau <span class="text-red-600">*</span></label>
            <input name="service" required class="w-full sketch bg-white px-3 py-2 outline-none" placeholder="Ex. Support, Ventes..." />
          </div>
        </div>

        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium mb-1">Site</label>
            <input name="site" class="w-full sketch bg-white px-3 py-2 outline-none" placeholder="Ex. Valenciennes / Amiens" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Niveau (auto-√©valuation)</label>
            <select name="niveau" class="w-full sketch bg-white px-3 py-2 outline-none">
              <option>D√©butant</option>
              <option selected>Interm√©diaire</option>
              <option>Confirm√©</option>
            </select>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">Cr√©neau pr√©f√©r√© (09 septembre)</label>
          <select name="creneau" id="creneauSelect" class="w-full sketch bg-white px-3 py-2 outline-none">
            <!-- 15 minutes chacun -->
            <option value="09:30-09:45">09:30 ‚Äì 09:45</option>
            <option value="11:00-11:15">11:00 ‚Äì 11:15</option>
            <option value="14:30-14:45">14:30 ‚Äì 14:45</option>
            <option value="16:00-16:15">16:00 ‚Äì 16:15</option>
          </select>
          <p class="text-xs mt-2 text-stone-600">Astuce : choisis un cr√©neau compatible avec la charge d‚Äôappels/activit√© de ton √©quipe.</p>
        </div>

        <div class="flex items-start gap-3">
          <input id="prod" type="checkbox" required class="mt-1 w-5 h-5 accent-black" />
          <label for="prod" class="text-sm">
            Je confirme avoir pr√©venu mon encadrant : l‚Äôatelier se d√©roule <b>sur le temps de production</b>.
          </label>
        </div>

        <div class="flex items-center gap-3 pt-2">
          <button type="submit" class="btn-oval bg-pastel-accent hover:bg-pastel-accent/80 px-6 py-2 font-semibold transition animate-pop">
            ‚úèÔ∏è S‚Äôinscrire
          </button>
          <button type="button" id="exportCsv" class="btn-oval bg-white hover:bg-stone-100 px-6 py-2">
            üìÑ Exporter (CSV)
          </button>
        </div>

        <p id="formMsg" class="mt-3 text-sm"></p>
      </form>
    </section>

    <!-- Side: infos & planification -->
    <aside class="lg:col-span-2 space-y-6">
      <div class="sketch bg-white/90 shadow-sk p-6">
        <h3 class="text-lg font-semibold flex items-center gap-2 mb-3">
          <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="#222" stroke-width="1.5">
            <path d="M4 6h16M4 12h16M10 18h10" />
          </svg>
          √Ä propos de la dict√©e
        </h3>
        <ul class="text-sm leading-6 list-disc ml-5">
          <li>Dur√©e : ~15 minutes, lecture + relecture.</li>
          <li>Th√®me : rentr√©e des classes (ton l√©ger üòä).</li>
          <li>Mat√©riel : stylo fourni. Photo de classe & collation √† la suite.</li>
        </ul>
      </div>

      <div class="sketch bg-pastel-green/50 shadow-sk p-6">
        <h3 class="text-lg font-semibold mb-2">Planification (vue locale)</h3>
        <div id="planTable" class="text-sm"></div>
        <p class="text-xs text-stone-700 mt-2">
          Cette r√©partition est affich√©e <b>sur ton navigateur</b> (localStorage). Pour une centralisation, connecte le formulaire √† ton backend / Google Sheet.
        </p>
      </div>

      <div class="sketch bg-white/90 shadow-sk p-6">
        <h3 class="text-lg font-semibold mb-2">Dress code üëî</h3>
        <p class="text-sm">Viens habill√©¬∑e <b>comme √† l‚Äô√©cole</b> : short/jupe, chemise, bretelles, chaussettes montantes‚Ä¶ On garde l‚Äôesprit bon enfant !</p>
      </div>
    </aside>
  </main>

  <!-- Toast -->
  <div id="toast" class="hidden fixed bottom-4 left-1/2 -translate-x-1/2 bg-emerald-600 text-white px-5 py-3 rounded-2xl shadow-lg">
    ‚úÖ Inscription enregistr√©e ! Ton fichier calendrier (.ics) est pr√™t.
  </div>

  <script>
    // --- Utils ---
    const DATE_ISO = '20250909'; // 9 septembre 2025
    const TZID = 'Europe/Paris';

    function $(sel){ return document.querySelector(sel) }
    function saveLocal(key, data){ localStorage.setItem(key, JSON.stringify(data)) }
    function loadLocal(key, fallback){ try { return JSON.parse(localStorage.getItem(key)) ?? fallback } catch { return fallback } }

    const STORAGE_KEY = 'dictee-inscriptions-v1';

    // --- Rendu planning local ---
    function renderPlanning(){
      const rows = loadLocal(STORAGE_KEY, []);
      // Agr√®ge par cr√©neau
      const map = {};
      rows.forEach(r => {
        map[r.creneau] = (map[r.creneau] || 0) + 1;
      });

      const creneaux = ['09:30-09:45','11:00-11:15','14:30-14:45','16:00-16:15'];
      const max = 20; // capacit√© indicative par cr√©neau (√† adapter)
      let html = '<div class="space-y-3">';
      creneaux.forEach(c => {
        const n = map[c] || 0;
        const pct = Math.min(100, Math.round((n / max) * 100));
        html += `
          <div>
            <div class="flex justify-between text-sm mb-1"><span>üïí ${c}</span><span>${n}/${max}</span></div>
            <div class="h-2 sketch overflow-hidden">
              <div class="h-full bg-emerald-600" style="width:${pct}%"></div>
            </div>
          </div>`;
      });
      html += '</div>';
      $('#planTable').innerHTML = html;
    }

    // --- G√©n√©ration ICS ---
    function makeICS({ title, description, startStr, endStr, location = '' }){
      // DTSTART/DTEND en heure locale avec TZID
      const ics =
`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//QVCT//Dictee//FR
CALSCALE:GREGORIAN
BEGIN:VEVENT
UID:${crypto.randomUUID()}
DTSTAMP:${new Date().toISOString().replace(/[-:]/g,'').split('.')[0]}Z
SUMMARY:${title}
DESCRIPTION:${description}
LOCATION:${location}
DTSTART;TZID=${TZID}:${startStr}
DTEND;TZID=${TZID}:${endStr}
END:VEVENT
END:VCALENDAR`;
      return 'data:text/calendar;charset=utf-8,' + encodeURIComponent(ics);
    }

    function slotToStartEnd(slot){ // "HH:MM-HH:MM" -> "YYYYMMDDTHHMMSS"
      const [s,e] = slot.split('-');
      const norm = t => DATE_ISO + 'T' + t.replace(':','') + '00';
      return { start: norm(s), end: norm(e) };
    }

    // --- Soumission ---
    const form = $('#inscriptionForm');
    form.addEventListener('submit', (e) => {
      e.preventDefault();

      // Validation HTML5 d√©j√† active; on ajoute un message lisible
      if (!form.reportValidity()){
        $('#formMsg').textContent = 'Merci de compl√©ter les champs requis.';
        $('#formMsg').className = 'mt-3 text-sm text-red-700';
        return;
      }

      const data = Object.fromEntries(new FormData(form).entries());
      data.creneau = form.creneau.value;

      // Sauvegarde locale
      const all = loadLocal(STORAGE_KEY, []);
      all.push(data);
      saveLocal(STORAGE_KEY, all);

      renderPlanning();

      // G√©n√©ration ICS
      const { start, end } = slotToStartEnd(data.creneau);
      const href = makeICS({
        title: 'Dict√©e de Rentr√©e ‚Äî Pause Cartable',
        description: `Participant: ${data.prenom} ${data.nom}\\nService: ${data.service}\\nDict√©e (15 min) sur le temps de production.`,
        startStr: start, endStr: end,
        location: data.site || 'Sur site'
      });

      // Lien de t√©l√©chargement imm√©diat
      const a = document.createElement('a');
      a.href = href;
      a.download = 'dictee_rentree_0909.ics';
      document.body.appendChild(a);
      a.click();
      a.remove();

      // UI feedback
      $('#formMsg').innerHTML = '‚úÖ Inscription enregistr√©e. Un fichier <b>.ics</b> a √©t√© t√©l√©charg√© pour ton calendrier.';
      $('#formMsg').className = 'mt-3 text-sm text-emerald-700';
      const toast = $('#toast');
      toast.classList.remove('hidden');
      setTimeout(()=> toast.classList.add('hidden'), 2500);

      form.reset();
    });

    // Export CSV (local)
    $('#exportCsv').addEventListener('click', () => {
      const rows = loadLocal(STORAGE_KEY, []);
      const header = ['prenom','nom','email','service','site','niveau','creneau'];
      const csv = [header.join(';')].concat(
        rows.map(r => header.map(h => (`${(r[h]||'')}`).replaceAll(';', ',')).join(';'))
      ).join('\\n');

      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'inscriptions_dictee_0909.csv';
      a.click();
      URL.revokeObjectURL(url);
    });

    renderPlanning();
  </script>

  <!-- Footer -->
  <footer class="max-w-5xl mx-auto px-4 pb-10">
    <div class="mt-6 text-xs text-stone-600 flex items-center justify-between">
      <span>¬© 2025 ‚Äî Journ√©e QVCT ‚ÄúPause Cartable‚Äù</span>
      <span class="inline-flex items-center gap-2">
        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="#222" stroke-width="1.5">
          <path d="M4 5h16M4 12h16M4 19h16"/>
        </svg>
        Dict√©e ‚Ä¢ Photo de classe ‚Ä¢ Collation
      </span>
    </div>
  </footer>
</body>
</html>
